<!DOCTYPE html>
<html>
<head>
  <title>OSRS Price Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>OSRS Price Tracker</h2>

<canvas id="chart"></canvas>

<script>

const SUPABASE_URL = "https://goabrqjuguybmvjlqylq.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdvYWJycWp1Z3V5Ym12amxxeWxxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNjMxOTgsImV4cCI6MjA4NjgzOTE5OH0.INEv8kOskPZO6fU6827a9XZkkl8Smzqht5_KVDzQ_Ro";

async function loadData() {

  const res = await fetch(
    `${SUPABASE_URL}/rest/v1/prices?item_id=eq.20997&order=timestamp.asc`,
    {
      headers: {
        apikey: SUPABASE_ANON_KEY,
        Authorization: `Bearer ${SUPABASE_ANON_KEY}`
      }
    }
  );

  const data = await res.json();

  const labels = data.map(d =>
    new Date(d.timestamp * 1000).toLocaleTimeString()
  );

  const prices = data.map(d => d.mid_price);

  new Chart(document.getElementById("chart"), {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "Twisted Bow Price",
        data: prices,
        borderWidth: 2
      }]
    }
  });

}

loadData();

</script>

</body>
</html>
